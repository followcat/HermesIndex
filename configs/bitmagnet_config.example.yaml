# Example HermesIndex config for bitmagnet.
# Replace placeholders with real table/columns.

gpu_endpoint: "http://localhost:8001"
embedding_model_version: "bge-m3"
nsfw_threshold: 0.7
local_embedder:
  enabled: false
  model_name: "BAAI/bge-m3"

postgres:
  # If you created a writable schema (e.g. hermes), set search_path so
  # sync_state is created there:
  # dsn: "postgresql://followcat:REPLACE_PASSWORD@127.0.0.1:5432/bitmagnet?options=-csearch_path=hermes,public"
  dsn: "postgresql://followcat:REPLACE_PASSWORD@127.0.0.1:5432/bitmagnet"
  fetch_batch_size: 500

# Bitmagnet plugin (auto-create views for content/torrent_files)
bitmagnet:
  enabled: true
  host: "127.0.0.1"
  port: 5432
  database: "bitmagnet"
  user: "followcat"
  password: "REPLACE_PASSWORD"
  schema: "hermes"
  create_schema: true

tmdb:
  enabled: false
  # api_key: "REPLACE_TMDB_KEY"
  api_key_env: "TMDB_API_KEY"
  # imdb:
  #   enabled: false
  #   api_key_env: "OMDB_API_KEY"
  #   base_url: "https://www.omdbapi.com"
  # douban:
  #   enabled: false
  #   base_url: "https://api.douban.com/v2/movie/imdb"
  #   api_key_env: ""
  #   api_key_param: "apikey"
  base_url: "https://api.themoviedb.org/3"
  language: "zh-CN"
  sleep_seconds: 1.0
  timeout_seconds: 10
  auto_enrich: false
  max_per_batch: 50
  query_expand: true
  query_expand_limit: 20

auth:
  enabled: false
  admin_user: "admin"
  admin_password: "CHANGE_ME"
  user_store_path: "data/users.json"
  token_store_path: "data/tokens.json"
  token_ttl_seconds: 86400

vector_store:
  type: "qdrant"
  url: "http://127.0.0.1:6333"
  collection: "bitmagnet_vectors"
  dim: 1024
  metric: "cosine"

sync:
  batch_size: 256
  concurrency: 2

sources:
  - name: "bitmagnet_torrents"
    pg:
      table: "REPLACE_TABLE"
      id_field: "REPLACE_ID_FIELD"
      text_field: "REPLACE_TEXT_FIELD"
      # updated_at_field: "updated_at"
      # extra_fields: ["size", "private", "files_count", "extension"]
      # size_field: "size"
      # Optional joins for tags/hints. Non-agg join fields assume 1:1.
      # joins:
      #   - table: "torrent_tags"
      #     alias: "tt"
      #     type: "left"
      #     on: "tt.info_hash = t.info_hash"
      #     fields:
      #       - column: "name"
      #         alias: "tags"
      #         agg: "array_agg"
      #         distinct: true
      #   - table: "torrent_hints"
      #     alias: "th"
      #     type: "left"
      #     on: "th.info_hash = t.info_hash"
      #     fields:
      #       - column: "title"
      #         alias: "hint_title"
      #       - column: "release_year"
      #         alias: "release_year"
      #       - column: "video_resolution"
      #         alias: "video_resolution"
      #       - column: "video_codec"
      #         alias: "video_codec"
    vector_index:
      index_name: "bitmagnet_title_v1"
      dim: 768
      metric: "cosine"
    tagging:
      nsfw: true
    sync:
      mode: "incremental"
      batch_size: 256
      concurrency: 2

  # Optional content source (when using hermes.content_view)
  # - name: "bitmagnet_content"
  #   pg:
  #     table: "hermes.content_view"
  #     id_field: "content_uid"
  #     text_field: "search_text"
  #     updated_at_field: "updated_at"
  #     extra_fields: ["title", "original_title", "overview", "type", "source", "id", "adult", "release_year", "tmdb_id", "imdb_id", "imdb_rating", "douban_rating", "genre", "aka", "keywords", "actors", "directors", "plot", "poster_path", "backdrop_path"]
  #     tmdb_enrich: true
  #     keyword_search: true
  #     keyword_fields: ["title", "original_title", "overview"]
  #   vector_index:
  #     index_name: "content_title_v1"
  #     dim: 768
  #     metric: "cosine"
  #   tagging:
  #     nsfw: true
  #   sync:
  #     mode: "incremental"
  #     batch_size: 256
  #     concurrency: 2
