# Global settings
gpu_endpoint: "http://localhost:8001"
embedding_model_version: "bge-m3"
nsfw_threshold: 0.7
local_embedder:
  enabled: false
  model_name: "BAAI/bge-m3"

postgres:
  dsn: "postgresql://user:password@localhost:5432/hermes"
  fetch_batch_size: 500

# Bitmagnet plugin (optional)
bitmagnet:
  enabled: false
  host: "127.0.0.1"
  port: 5432
  database: "bitmagnet"
  user: "followcat"
  password: "REPLACE_PASSWORD"
  schema: "hermes"
  create_schema: true

# TMDB enrichment (optional, uses API key from env)
tmdb:
  enabled: false
  # api_key: "REPLACE_TMDB_KEY"
  api_key_env: "TMDB_API_KEY"
  base_url: "https://api.themoviedb.org/3"
  language: "zh-CN"
  sleep_seconds: 1.0
  timeout_seconds: 10
  auto_enrich: false
  max_per_batch: 50
  query_expand: true
  query_expand_limit: 20
  # imdb:
  #   enabled: false
  #   api_key_env: "OMDB_API_KEY"
  #   base_url: "https://www.omdbapi.com"
  # douban:
  #   enabled: false
  #   base_url: "https://api.douban.com/v2/movie/imdb"
  #   api_key_env: ""
  #   api_key_param: "apikey"
  # limits:
  #   actors: 10
  #   directors: 5
  #   aka: 10

# 简易认证（可选）
auth:
  enabled: false
  admin_user: "admin"
  admin_password: "CHANGE_ME"
  user_store_path: "data/users.json"
  token_store_path: "data/tokens.json"
  token_ttl_seconds: 86400

vector_store:
  type: "hnsw"
  path: "./data/index"
  max_elements: 1500000
  dim: 768
  metric: "cosine"
  ef_construction: 200
  M: 16
  ef_search: 64

# Qdrant 示例（启用时替换上方配置）：
# vector_store:
#   type: "qdrant"
#   url: "http://localhost:6333"
#   collection: "hermes_vectors"
#   dim: 768
#   metric: "cosine"
#   api_key: ""

# Milvus 示例：
# vector_store:
#   type: "milvus"
#   uri: "http://localhost:19530"
#   collection: "hermes_vectors"
#   dim: 768
#   metric: "cosine"

sync:
  batch_size: 256
  concurrency: 2

# Celery 调度（可选）
# celery:
#   broker_url: "redis://localhost:6379/0"
#   backend_url: "redis://localhost:6379/1"
#   schedule_seconds: 600  # 定时全量增量同步周期

sources:
  - name: "torrents"
    pg:
      table: "torrents"
      id_field: "id"
      text_field: "title"
      updated_at_field: "updated_at"   # optional
      extra_fields: ["category", "size"]
      size_field: "size"
    vector_index:
      index_name: "torrents_title_v1"
      dim: 768
      metric: "cosine"
    tagging:
      nsfw: true
    sync:
      mode: "incremental"
      batch_size: 256
      concurrency: 2
  - name: "files"
    pg:
      table: "files"
      id_field: "id"
      text_field: "name"
    vector_index:
      index_name: "files_name_v1"
      dim: 768
      metric: "cosine"
    tagging:
      nsfw: false
